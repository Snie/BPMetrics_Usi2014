<!DOCTYPE html>
<html>

<head>
    <title>Demo</title>
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

    <script src="../bower_components/webcomponentsjs/webcomponents.js"></script>

    <link rel="import"
          href="./bower_components/font-roboto/roboto.html">
    <link rel="import"
          href="./bower_components/core-header-panel/core-header-panel.html">
    <link rel="import"
          href="./bower_components/core-toolbar/core-toolbar.html">
    <link rel="import"
          href="./bower_components/paper-tabs/paper-tabs.html">
    <link rel="import"
          href="./bower_components/core-icon-button/core-icon-button.html">
    <link rel="import"
          href="./bower_components/core-overlay/core-overlay.html">
    <link rel="import"
          href="metric-list.html">
    <link rel="import"
          href="side-list.html">
    <link rel="import"
          href="./bower_components/core-dropdown-menu/core-dropdown-menu.html">
    <link rel="import"
          href="./bower_components/core-input/core-input.html">
    <link rel="import"
          href="./bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
    <link rel="import"
          href="./bower_components/paper-dropdown/paper-dropdown.html">
    <link rel="import"
          href="./bower_components/paper-item/paper-item.html">
    <link rel="import"
          href="./bower_components/core-ajax/core-ajax.html">
    <link rel="import"
          href="./bower_components/core-drawer-panel/core-drawer-panel.html">
    <link rel="import"
          href="../bower_components/paper-toast/paper-toast.html">
    <link rel="import"
          href="signup-card.html">
    <link rel="import"
          href="login-card.html">


    <script type="text/javascript" src="./js/checkfiles.js"></script>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script src="../bower_components/jquery-1.11.1.min.js"></script>

    <style>
        html,body {
            height: 100%;
            margin: 0;
            /*background: url("../resources/pixelchristmasred.png");*/
            background: #efefef;
            background-size: 100%;
            font-family: 'RobotoDraft', sans-serif;
        }


        metric-list{
            margin: auto;
        }

        core-header-panel {
            height: 70px;
            overflow: auto;
            -webkit-overflow-scrolling: touch;
        }
        core-toolbar{
            background: #da4336;
            color: white;
        }
        #tabs {
            width: 100%;
            margin: 0;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            text-transform: uppercase;
        }
        core-icon-button{
            background: #E5E5E5;
            border: solid 1px #d0d0d0;
            margin:19px;
            border-radius: 50%;
        }
        core-icon-button:hover{
            border: none;
            margin:20px;
            border-radius: 50%;
        }
        core-dropdown {
            position: absolute;
            top: 38px;
            left: 0;
        }
        paper-dropdown-menu{
            padding: 5px;
            background: #E5E5E5;
            width:150px;
        }
        #sidebar{
            background: #F5F5F5;
        }
        core-overlay{
            width: 500px;
            height: 100%;
            overflow: hidden;
        }
        paper-toast {
            bottom: 40px;
            left: 10px;
        }
    </style>


</head>

<body unresolved>

        <core-header-panel>
            <core-toolbar>
                <paper-tabs id="tabs" selected="model" noink="true" self-end>
                    <paper-tab name="model">Demo</paper-tab>
                    <paper-tab name="start">Get Started</paper-tab>
                </paper-tabs>
            </core-toolbar>
        </core-header-panel>

        <core-overlay id="signUp" backdrop="true" autoCloseDisabled="true">
            <div id="frontForm">
                <signup-card></signup-card>
            </div>
            <div id="backForm" style="display: none">
                <login-card></login-card>
            </div>

        </core-overlay>

        <div id="container" layout vertical center>

            <paper-dropdown-menu label="All">
                <paper-dropdown class="dropdown">
                    <core-menu class="menu">
                        <paper-item class="menu-item" id="ALL">All</paper-item>
                        <paper-item class="menu-item" id="SINGLE_VALUE">Single Value</paper-item>
                        <paper-item class="menu-item" id="DISTRIBUTION">Distribution</paper-item>
                        <paper-item class="menu-item" id="TYPE_DISTRIBUTION">Type Distribution</paper-item>
                    </core-menu>
                </paper-dropdown>
            </paper-dropdown-menu>

            <div layout horizontal center>
                <!--<core-icon-button icon="menu" core-drawer-toggle></core-icon-button>-->
                <core-icon-button id="add" icon="add"></core-icon-button>
            </div>

            <form id="form" style="display: none;" method="post" enctype="multipart/form-data" action="/demofiles">
                <input id="uploaded" type="file" name="uploaded" title="upload">
                <input id="submit" type="submit">
            </form>

            <div id="list">
                <!--<metric-list tipo='ALL' myID='b18f4aa4199545afb2c48e9f8b714972'></metric-list>-->
            </div>


        </div>


        <!--Messages to the user-->
        <paper-toast id="signup-card_message_204" role="alert" text="New account created!" touch-action="none" tabindex="-1" class="core-transition core-transition-bottom" style="position: fixed; outline: none; display: none;">
            <div style="color: #eeff41;" onclick="console.log('CLOSE')">CLOSE</div>
        </paper-toast>
        <paper-toast id="signup-card_message_400" role="alert" text="User name or email already used!" touch-action="none" tabindex="-1" class="core-transition core-transition-bottom" style="position: fixed; outline: none; display: none;">
            <div style="color: #eeff41;" onclick="console.log('CLOSE')">CLOSE</div>
        </paper-toast>
        <paper-toast id="signup-card_1" role="alert" text="Please, insert your first name!" touch-action="none" tabindex="-1" class="core-transition core-transition-bottom" style="position: fixed; outline: none; display: none;">
            <div style="color: #eeff41;" onclick="console.log('CLOSE')">CLOSE</div>
        </paper-toast>
        <paper-toast id="signup-card_2" role="alert" text="Please, insert your last name!" touch-action="none" tabindex="-1" class="core-transition core-transition-bottom" style="position: fixed; outline: none; display: none;">
            <div style="color: #eeff41;" onclick="console.log('CLOSE')">CLOSE</div>
        </paper-toast>
        <paper-toast id="signup-card_3" role="alert" text="Please, insert your user name!" touch-action="none" tabindex="-1" class="core-transition core-transition-bottom" style="position: fixed; outline: none; display: none;">
            <div style="color: #eeff41;" onclick="console.log('CLOSE')">CLOSE</div>
        </paper-toast>
        <paper-toast id="signup-card_4" role="alert" text="Please, insert your email!" touch-action="none" tabindex="-1" class="core-transition core-transition-bottom" style="position: fixed; outline: none; display: none;">
            <div style="color: #eeff41;" onclick="console.log('CLOSE')">CLOSE</div>
        </paper-toast>
        <paper-toast id="signup-card_5" role="alert" text="The email is not valid!" touch-action="none" tabindex="-1" class="core-transition core-transition-bottom" style="position: fixed; outline: none; display: none;">
            <div style="color: #eeff41;" onclick="console.log('CLOSE')">CLOSE</div>
        </paper-toast>
        <paper-toast id="signup-card_6" role="alert" text="Please, insert your password!" touch-action="none" tabindex="-1" class="core-transition core-transition-bottom" style="position: fixed; outline: none; display: none;">
            <div style="color: #eeff41;" onclick="console.log('CLOSE')">CLOSE</div>
        </paper-toast>
        <paper-toast id="signup-card_7" role="alert" text="Please, repeat your password!" touch-action="none" tabindex="-1" class="core-transition core-transition-bottom" style="position: fixed; outline: none; display: none;">
            <div style="color: #eeff41;" onclick="console.log('CLOSE')">CLOSE</div>
        </paper-toast>
        <paper-toast id="signup-card_8" role="alert" text="The repeat password is not the same as password!" touch-action="none" tabindex="-1" class="core-transition core-transition-bottom" style="position: fixed; outline: none; display: none;">
            <div style="color: #eeff41;" onclick="console.log('CLOSE')">CLOSE</div>
        </paper-toast>
        <paper-toast id="signup-card_length" role="alert" text="The password should have at least 6 characters!" touch-action="none" tabindex="-1" class="core-transition core-transition-bottom" style="position: fixed; outline: none; display: none;">
            <div style="color: #eeff41;" onclick="console.log('CLOSE')">CLOSE</div>
        </paper-toast>
        <paper-toast id="login-card_message_401" role="alert" text="User name or password wrong!" touch-action="none" tabindex="-1" class="core-transition core-transition-bottom" style="position: fixed; outline: none; display: none;">
            <div style="color: #eeff41;" onclick="console.log('CLOSE')">CLOSE</div>
        </paper-toast>
        <!--Messages to the user-->

<script>
    localStorage['stack'] = "";
    var temp;
    var list = document.querySelector('metric-list');

    $('.menu-item').on('click', function(){
        list.tipo = this.id;
    });

    tabs.addEventListener('core-select', function() {
        if(tabs.selected == 'back'){
            window.location.href = '/starter/index.html';
        }
        else if(tabs.selected == 'start'){
            document.getElementById('signUp').opened = true;
        }
    });

    function demoSelect(s){
        document.getElementById('signUp').opened = false;
        $('#tabs').selected = 'model';
    }

    $('#add').click(function() {
        $('#uploaded').trigger('click');
    });

    $(':file').change(function(){

//        checkfiles(this);

        var file = this.files[0];
        var name = file.name;
        var size = file.size;
        var type = file.type;

        var formData = new FormData($('form')[0]);

        $.ajax({
            url: '/demofiles',  //Server script to process data
            type: 'POST',
            xhr: function() {  // Custom XMLHttpRequest
                var myXhr = $.ajaxSettings.xhr();
//                if(myXhr.upload){ // Check if upload property exists
//                    myXhr.upload.addEventListener('progress',progressHandlingFunction, false); // For handling the progress of the upload
//                }
                return myXhr;
            },
            //Ajax events
//            beforeSend: beforeSendHandler,
            success: function(result){
                console.log(result);
                if(localStorage['stack'] == '') {
                    localStorage['stack'] = result.id;
                } else {
                    localStorage['stack'] += "," + result.id;
                }
                console.log(localStorage['stack']);
            },
//            error: errorHandler,
            // Form data
            data: formData,
            //Options to tell jQuery not to process data or worry about content-type.
            cache: false,
            contentType: false,
            processData: false
        });

    });

    function getCollection(id){
        if(!id){
            return false;
        }
        console.log(id);
        var url= '/models/demo/'+id;

        $.ajax({
            url: url,
            type: 'GET',
            async: false,
//            accepts: 'application/json',
            success: function(result){
                if(result.collectionID){
                    return false;
                }
                else{
                    document.getElementById('list').innerHTML = "<metric-list tipo='ALL' myID='"+result[0].collectionID+"'></metric-list>";
                    return true;
                }
            },
            error: function (xhr, status) {
                return false;
            }
        });
    }

    function polling() {
        var toSplit = localStorage['stack'];
        if (toSplit != '') {
            var ids = toSplit.split(',');
//            console.log(toSplit);
//            console.log("ids: " + ids);
            var tmp = '';
            for (var id in ids) {

                var collIDReturn = getCollection(ids[id]);

//                console.log("collIDReturn: " + collIDReturn);

                if (collIDReturn == false) {

                    if (tmp == '') {
                        tmp = ids[id];
                    } else {
                        tmp += "," + ids[id];
                    }

                }
            }

            localStorage['stack'] = tmp;

            console.log("New Stack: " + localStorage['stack']);
        }
    }

    var refreshIntervalId = setInterval(function(){polling()}, 5000);





</script>


</body>